CDECK  ID>, GAS54.
      SUBROUTINE GAS54(Q,QIN,NIN,E,EIN,NAME,VIRIAL,EOBY
     /,PEQEL,PEQIN,KEL,KIN,SCRPT)
      IMPLICIT REAL*8 (A-H,O-Z)
*   Array dimensions.
       integer mxngas
       parameter(mxngas=6)
*   Grouped AN1 ... AN6 in ANn
       DOUBLE PRECISION ANn,AN,FRAC
       COMMON /RATIO/ ANn(mxngas),AN,FRAC(mxngas)
       INTEGER NGASN
       COMMON /GASN/ NGASN(mxngas)
       DOUBLE PRECISION PIR2,ECHARG,EMASS,AMU,BOLTZ,BOLTZJ,
     -      AWB,ALOSCH,ABZERO,ATMOS
       PARAMETER(PIR2=8.79735534D-17)
       PARAMETER(ECHARG=1.602176462D-19)
       PARAMETER(EMASS=9.10938188D-31)
       PARAMETER(AMU=1.66053873D-27)
       PARAMETER(BOLTZ=8.617342D-5)
       PARAMETER(BOLTZJ=1.3806503D-23)
       PARAMETER(AWB=1.758820174D10)
       PARAMETER(ALOSCH=2.6867775D19)
       PARAMETER(ABZERO=273.15D0)
       PARAMETER(ATMOS=760.0D0)
       INTEGER NGAS,NSTEP,IDBG
       DOUBLE PRECISION EFINAL,ESTEP,AKT,ARY,TEMPC,TORR
       PARAMETER(ARY=13.60569172)
       COMMON/INPT/NGAS,NSTEP,EFINAL,ESTEP,AKT,TEMPC,TORR,IDBG
      DIMENSION PEQEL(6,2048),PEQIN(220,2048),KIN(220),KEL(6)
      DIMENSION Q(6,2048),QIN(220,2048),E(6),EIN(220)
      DIMENSION XEN(79),YXSEC(79),XION(52),YION(52)
      DIMENSION XDIM(10),YDIM(10)
      DIMENSION XEXC3(28),YEXC3(28),XEXC4(32),YEXC4(32),XEXC5(20)
      DIMENSION YEXC5(20),XEXC6(24),YEXC6(24),YEXC7(12),XEXC7(12)
      DIMENSION YEXC8(12),XEXC8(12),XEL(57),YEL(57)
      CHARACTER*30 SCRPT(226)
      CHARACTER*15 NAME
C   ELASTIC MOMENTUM TRANSFER ENGLAND+ELFORD 1991 (MOD 2003 EL+MC)
      DATA XEN/0.00,.005,0.01,.015,0.02,0.03,0.04,0.05,0.06,0.07,
     /0.08,0.09,0.10,0.12,0.13,0.14,0.15,0.16,0.17,0.18,
     /0.19,0.20,0.21,0.22,0.23,0.24,0.26,0.28,0.30,0.32,
     /0.34,0.36,0.38,0.39,0.40,0.41,0.42,0.43,0.44,0.46,
     /0.48,0.50,0.55,0.60,0.65,0.70,0.75,0.80,0.90,1.00,
     /1.20,1.40,1.60,1.80,2.00,2.50,3.00,4.00,5.00,6.00,
     /7.00,8.00,9.00,10.0,12.0,15.0,25.0,35.0,50.0,100.,
     /150.,300.,400.,500.,1000.,2000.,4000.,10000.,100000./
      DATA YXSEC/13.7,13.8,13.9,14.2,15.0,16.5,18.0,20.5,23.0,26.5,
     /30.0,34.0,39.4,54.9,62.9,71.0,78.9,86.5,94.2,102.,
     /109.,115.,121.,127.,133.,139.,149.,159.,168.,177.,
     /186.,195.,204.,208.,211.,214.,217.,219.,220.,219.,
     /215.,209.,190.,174.,161.,151.,143.,136.,123.,113.,
     /95.5,82.0,70.0,60.5,51.5,37.0,29.0,20.0,14.7,10.8,
     /8.17,5.63,4.29,3.37,3.00,2.95,4.00,4.40,3.60,1.35,
     /0.95,0.79,.826,.752,0.57,0.28,0.14,.056,.0056/
C ELASTIC TOTAL  ELFORD AND MCEARCHAN THEORY
      DATA XEL/0.00,.001,.002,.004,.007,0.01,0.02,0.03,0.04,0.05,
     /0.06,0.07,0.08,0.09,0.10,0.15,0.20,0.25,0.30,0.35,
     /0.40,0.45,0.50,0.55,0.60,0.70,0.80,0.90,1.00,1.20,
     /1.40,1.60,1.80,2.00,3.00,4.00,5.00,6.00,7.00,8.00,
     /9.00,10.0,12.0,15.0,25.0,35.0,50.0,100.,150.,300.,
     /400.,500.,1000.,2000.,4000.,10000.,100000./
      DATA YEL/12.33,17.4,17.9,19.2,21.2,20.4,23.5,26.0,28.2,30.4,
     /32.5,34.7,37.0,39.4,42.0,58.1,81.7,113.,147.,176.,
     /194.,203.,205.,205.,203.,195.,185.,173.,162.,142.,
     /126.,113.,102.,93.1,63.5,46.5,35.3,27.8,22.2,19.4,
     /16.5,14.3,12.5,11.0,9.60,9.00,9.00,8.80,7.50,4.90,
     /3.90,3.40,2.30,1.40,0.90,0.50,0.12/
C IONISATION
      DATA XION/10.4375,15.0,17.5,20.0,25.0,30.0,35.0,40.0,45.0,
     /50.0,55.0,60.0,65.0,70.0,75.0,80.0,90.0,100.,125.,
     /150.,175.,200.,250.,300.,350.,400.,450.,500.,550.,
     /600.,650.,700.,800.,900.,1000.,1500.,2000.,2500.,3000.,
     /3500.,4000.,4500.,5000.,6000.,7000.,8000.,9000.,10000.,11000.,
     /20000.,50000.,100000./
      DATA YION/0.00,1.13,2.47,2.68,3.79,4.50,5.09,5.44,5.75,
     /5.95,6.09,6.22,6.27,6.37,6.38,6.42,6.37,6.27,5.92,
     /5.72,5.44,5.17,4.77,4.34,4.01,3.87,3.46,3.24,3.13,
     /3.07,2.80,2.70,2.37,2.20,2.12,1.62,1.31,1.11,.976,
     /.859,.763,.691,.612,.513,.431,.373,.332,.300,.274,
     /.150,.060,.030/
C  DIMER X-SECTION (ENGLAND AND ELFORD AJP 44(1991)647-675)
      DATA XDIM/.040,.045,0.09,0.17,0.40,4.00,40.0,400.,4000.,100000./
      DATA YDIM/0.00,8.30,8.30,1.25,0.83,.083,.008,.0008,.00008,.000003/
C EXCITATION
      DATA XEXC3/4.667,4.70,4.80,4.90,5.00,5.10,5.20,5.30,5.40,5.50,
     /5.60,5.70,5.80,5.90,6.00,6.25,6.50,7.00,7.25,7.50,
     /10.0,12.0,15.0,20.0,30.0,100.,1000.,100000./
      DATA YEXC3/0.00,0.10,0.60,0.25,0.30,0.40,0.55,0.68,0.85,0.95,
     /0.95,0.90,0.85,0.75,0.70,0.65,0.60,0.50,0.48,0.45,
     /0.15,0.09,.044,.019,.005,.00015,.000005,.0000000001/
      DATA XEXC4/4.887,4.90,5.00,5.10,5.20,5.30,5.40,5.50,5.60,5.70,
     /5.80,5.90,6.00,6.25,6.50,7.00,7.25,7.50,10.0,12.0,
     /15.0,20.0,30.0,60.0,100.,150.,200.,400.,1000.,2000.,
     /10000.,100000./
      DATA YEXC4/0.00,0.20,1.20,2.50,1.50,1.40,1.60,2.00,2.40,2.50,
     /2.45,2.30,2.15,1.95,1.75,1.55,1.50,1.45,0.80,0.60,
     /0.39,0.34,0.27,0.19,0.13,.085,0.06,0.03,.012,.006,
     /.0012,.00012/
      DATA XEXC5/5.461,5.50,5.60,5.70,5.80,5.90,6.00,6.25,6.50,7.00,
     /7.25,7.50,10.0,15.0,20.0,30.0,40.0,100.,1000.,100000./
      DATA YEXC5/0.00,0.80,2.00,3.20,3.50,3.65,3.60,3.45,3.25,2.60,
     /2.45,2.30,0.90,0.23,0.10,.028,.012,.0009,.000001,.00000001/
      DATA XEXC6/6.704,7.00,7.50,8.00,9.00,10.0,11.0,12.5,15.0,20.0,
     /25.0,35.0,40.0,50.0,60.0,100.,150.,200.,400.,1000.,
     /2000.,5000.,10000.,100000./
      DATA YEXC6/0.00,0.08,0.20,0.50,1.50,2.05,2.50,3.05,3.55,4.25,
     /4.55,4.50,4.40,4.15,3.75,3.00,2.45,2.10,1.25,0.65,
     /0.34,0.14,0.07,.007/
      DATA XEXC7/7.926,9.00,10.0,20.0,40.0,60.0,100.,200.,1000.,2000.,
     /10000.,100000./
      DATA YEXC7/0.00,0.25,0.15,0.14,0.13,0.11,0.07,0.04,.008,.004,
     /.0008,.00008/
      DATA XEXC8/8.60,10.0,11.0,20.0,40.0,60.0,100.,200.,1000.,2000.,
     /10000.,100000./
      DATA YEXC8/0.00,0.75,0.45,0.42,0.39,0.32,0.21,0.12,.024,.012,
     /.0024,.00024/
C -------------------------------------------------------------------
      NAME='Hg2 (2003)'
C-------------------------------------------------------------------
C --------------------------------------------------------------------
C  ISOTROPIC SCATTERING VERSION OF MERCURY WITH DIMERS USES AMALGAM OF
C  ELFORD AND MCEARCHAN  2003             AND
C  ENGLAND AND ELFORD    1993
C  CONTAINS POSSIBLE EXTENSION TO ANISOTROPIC SCATTERING USING THE
C  THEORETICAL ELASTIC X-SECTION OF ELFORD AND MCEARCHAN.
C
C  DIMER FRACTION IN GAS FOR NITROGEN AND HELIUM MIXTURES AND PURE
C  MERCURY  SHOWN AS PARAMETER EANDE (BELOW) FOR GENERAL PURPOSE USE
C  HAVE SET EANDE TO NITROGEN MIXTURE VALUE.
C  FOR LARGE FRACTIONS OF MERCURY AT LOW FIELDS USE BOLTZMAN SOLUTION
C  SINCE  BACKGROUND GAS MOVEMENT (KT TERM) IS IMPORTANT .
C  USE MONTE CARLO (KT=0 BACKGROUND GAS STATIONARY) FOR MOST OTHER CASES
C --------------------------------------------------------------------
C
C  FIND FRACTION OF GAS FOR DIMER NORMALISATION
C
      GFRAC=0.0
      DO 11 IDGS=1,mxngas
       IF(NGASN(IDGS).EQ.55) THEN
        GFRAC=FRAC(IDGS)
       ENDIF
   11 CONTINUE
      GFRAC=GFRAC/100.0
C-------------------------------------------------------------
C  DIMER NORMALISATION
C  PURE MERCURY  EANDE=0.00221
C  N2-HG MIX     EANDE=0.00162
C  HE-HG MIX     EANDE=0.00067
      EANDE=0.00221
      DNORM=GFRAC*(573.0/(273.15+TEMPC))*TORR/760.0
      DNORM=DNORM*EANDE
C---------------------------------------------------------------
      NIN=8
      DO 1 J=1,6
    1 KEL(J)=0
      DO 2 J=1,NIN
    2 KIN(J)=0
      NDATA=79
      NEL=57
      NION=52
      NDIM=10
      NEXC3=28
      NEXC4=32
      NEXC5=20
      NEXC6=24
      NEXC7=12
      NEXC8=12
      E(1)=0.0
      E(2)=2.0*EMASS/(200.59*AMU)
      E(3)=10.4375
      E(4)=0.0
      E(5)=0.0
      E(6)=0.0
      EOBY=10.4375
      EIN(1)=-0.040
      EIN(2)=0.040
      EIN(3)=4.667
      EIN(4)=4.887
      EIN(5)=5.461
      EIN(6)=6.704
      EIN(7)=7.926
      EIN(8)=8.60
      SCRPT(1)='                              '
      SCRPT(2)=' ELASTIC (ISOT)  MERCURY      '
      SCRPT(3)=' IONISATION    ELOSS= 10.4375 '
      SCRPT(4)='                              '
      SCRPT(5)='                              '
      SCRPT(6)='                              '
      SCRPT(7)=' EXC DIMER SUP ELOSS= -0.040  '
      SCRPT(8)=' EXC DIMER     ELOSS=  0.040  '
      SCRPT(9)=' EXC 3P0       ELOSS=  4.667  '
      SCRPT(10)=' EXC 3P1       ELOSS=  4.887  '
      SCRPT(11)=' EXC 3P2       ELOSS=  5.461  '
      SCRPT(12)=' EXC 1P1       ELOSS=  6.704  '
      SCRPT(13)=' EXC 1S0       ELOSS=  7.926  '
      SCRPT(14)=' EXC HIGH      ELOSS=  8.60   '
      APOPDM=EXP(EIN(1)/AKT)
      EN=-ESTEP/2.0D0
      DO 900 I=1,NSTEP
      EN=EN+ESTEP
C USE LOG INTERPOLATION FOR ELASTIC AND MT X-SECTIONS
      IF(EN.LE.XEL(2)) THEN
       QELA=YEL(1)*1.D-16
       GO TO 125
      ENDIF
      DO 110 J=2,NEL
      IF(EN.LE.XEL(J)) GO TO 120
  110 CONTINUE
      J=NEL
  120 YXJ=LOG(YEL(J))
      YXJ1=LOG(YEL(J-1))
      XNJ=LOG(XEL(J))
      XNJ1=LOG(XEL(J-1))
      A=(YXJ-YXJ1)/(XNJ-XNJ1)
      B=(XNJ1*YXJ-XNJ*YXJ1)/(XNJ1-XNJ)
      QELA=EXP(A*LOG(EN)+B)*1.D-16
  125 IF(EN.LE.XEN(2)) THEN
       QMOM=YXSEC(1)*1.D-16
       GO TO 200
      ENDIF
      DO 150 J=2,NDATA
      IF(EN.LE.XEN(J)) GO TO 160
  150 CONTINUE
      J=NDATA
  160 YXJ=LOG(YXSEC(J))
      YXJ1=LOG(YXSEC(J-1))
      XNJ=LOG(XEN(J))
      XNJ1=LOG(XEN(J-1))
      A=(YXJ-YXJ1)/(XNJ-XNJ1)
      B=(XNJ1*YXJ-XNJ*YXJ1)/(XNJ1-XNJ)
      QMOM=EXP(A*LOG(EN)+B)*1.D-16
  200 CONTINUE
C------------------------------------------------------------------
C ANISOTROPIC VERSION DECOMMENT 2 LINES BELOW AND COMMENT NEXT TWO
C ALSO CHANGE SCRIPT DESCRIPTOR  : SCRPT(2) AND SET KEL(2)=1
C     PEQEL(2,I)=0.5+(QELA-QMOM)/QELA
C     Q(2,I)=QELA
C--------------------------------------------------------------
      PEQEL(2,I)=0.0D0
      Q(2,I)=QMOM
C--------------------------------------------------------------
C IONISATION
      Q(3,I)=0.0D0
      IF(EN.LE.E(3)) GO TO 230
      DO 210 J=2,NION
      IF(EN.LE.XION(J)) GO TO 220
  210 CONTINUE
      J=NION
  220 A=(YION(J)-YION(J-1))/(XION(J)-XION(J-1))
      B=(XION(J-1)*YION(J)-XION(J)*YION(J-1))/(XION(J-1)-XION(J))
      Q(3,I)=(A*EN+B)*1.0D-16
  230 CONTINUE
      Q(4,I)=0.0D0
      Q(5,I)=0.0D0
      Q(6,I)=0.0D0
C DIMER SUPERELASTIC
      QIN(1,I)=0.0D0
      IF(EN.LE.0.0) GO TO 300
      DO 250 J=2,NDIM
      IF((EN+EIN(2)).LE.XDIM(J)) GO TO 270
  250 CONTINUE
      J=NDIM
  270 A=(YDIM(J)-YDIM(J-1))/(XDIM(J)-XDIM(J-1))
      B=(XDIM(J-1)*YDIM(J)-XDIM(J)*YDIM(J-1))/(XDIM(J-1)-XDIM(J))
      QIN(1,I)=(EN+EIN(2))*(A*(EN+EIN(2))+B)*1.D-16/EN
      QIN(1,I)=QIN(1,I)*APOPDM/(1.0+APOPDM)
      QIN(1,I)=QIN(1,I)*DNORM
  300 CONTINUE
C DIMER
      QIN(2,I)=0.0D0
      IF(EN.LE.EIN(2)) GO TO 340
      DO 310 J=2,NDIM
      IF(EN.LE.XDIM(J)) GO TO 320
  310 CONTINUE
      J=NDIM
  320 A=(YDIM(J)-YDIM(J-1))/(XDIM(J)-XDIM(J-1))
      B=(XDIM(J-1)*YDIM(J)-XDIM(J)*YDIM(J-1))/(XDIM(J-1)-XDIM(J))
      QIN(2,I)=(A*EN+B)*1.D-16
      QIN(2,I)=QIN(2,I)/(1.0+APOPDM)
      QIN(2,I)=QIN(2,I)*DNORM
  340 CONTINUE
C  EXC 3P0
      QIN(3,I)=0.0D0
      IF(EN.LE.EIN(3)) GO TO 370
      DO 350 J=2,NEXC3
      IF(EN.LE.XEXC3(J)) GO TO 360
  350 CONTINUE
      J=NEXC3
  360 A=(YEXC3(J)-YEXC3(J-1))/(XEXC3(J)-XEXC3(J-1))
      B=(XEXC3(J-1)*YEXC3(J)-XEXC3(J)*YEXC3(J-1))/(XEXC3(J-1)-XEXC3(J))
      QIN(3,I)=(A*EN+B)*1.0D-16
  370 CONTINUE
C EXC 3P1
      QIN(4,I)=0.0D0
      IF(EN.LE.EIN(4)) GO TO 470
      DO 450 J=2,NEXC4
      IF(EN.LE.XEXC4(J)) GO TO 460
  450 CONTINUE
      J=NEXC4
  460 A=(YEXC4(J)-YEXC4(J-1))/(XEXC4(J)-XEXC4(J-1))
      B=(XEXC4(J-1)*YEXC4(J)-XEXC4(J)*YEXC4(J-1))/(XEXC4(J-1)-XEXC4(J))
      QIN(4,I)=(A*EN+B)*1.0D-16
  470 CONTINUE
C  EXC 3P2
      QIN(5,I)=0.0D0
      IF(EN.LE.EIN(5)) GO TO 570
      DO 550 J=2,NEXC5
      IF(EN.LE.XEXC5(J)) GO TO 560
  550 CONTINUE
      J=NEXC5
  560 A=(YEXC5(J)-YEXC5(J-1))/(XEXC5(J)-XEXC5(J-1))
      B=(XEXC5(J-1)*YEXC5(J)-XEXC5(J)*YEXC5(J-1))/(XEXC5(J-1)-XEXC5(J))
      QIN(5,I)=(A*EN+B)*1.0D-16
  570 CONTINUE
C EXC 1P1
      QIN(6,I)=0.0D0
      IF(EN.LE.EIN(6)) GO TO 670
      DO 650 J=2,NEXC6
      IF(EN.LE.XEXC6(J)) GO TO 660
  650 CONTINUE
      J=NEXC6
  660 A=(YEXC6(J)-YEXC6(J-1))/(XEXC6(J)-XEXC6(J-1))
      B=(XEXC6(J-1)*YEXC6(J)-XEXC6(J)*YEXC6(J-1))/(XEXC6(J-1)-XEXC6(J))
      QIN(6,I)=(A*EN+B)*1.0D-16
  670 CONTINUE
C EXC 1S0
      QIN(7,I)=0.0D0
      IF(EN.LE.EIN(7)) GO TO 770
      DO 750 J=2,NEXC7
      IF(EN.LE.XEXC7(J)) GO TO 760
  750 CONTINUE
      J=NEXC7
  760 A=(YEXC7(J)-YEXC7(J-1))/(XEXC7(J)-XEXC7(J-1))
      B=(XEXC7(J-1)*YEXC7(J)-XEXC7(J)*YEXC7(J-1))/(XEXC7(J-1)-XEXC7(J))
      QIN(7,I)=(A*EN+B)*1.0D-16
  770 CONTINUE
C EXC SUM HIGHER LEVELS
      QIN(8,I)=0.0D0
      IF(EN.LE.EIN(8)) GO TO 870
      DO 850 J=2,NEXC8
      IF(EN.LE.XEXC8(J)) GO TO 860
  850 CONTINUE
      J=NEXC8
  860 A=(YEXC8(J)-YEXC8(J-1))/(XEXC8(J)-XEXC8(J-1))
      B=(XEXC8(J-1)*YEXC8(J)-XEXC8(J)*YEXC8(J-1))/(XEXC8(J-1)-XEXC8(J))
      QIN(8,I)=(A*EN+B)*1.0D-16
  870 CONTINUE
      Q(1,I)=Q(2,I)+Q(3,I)+QIN(1,I)+QIN(2,I)+QIN(3,I)+QIN(4,I)+QIN(5,I)+
     /QIN(6,I)+QIN(7,I)+QIN(8,I)
  900 CONTINUE
      IF(EFINAL.LT.EIN(8)) NIN=7
      IF(EFINAL.LT.EIN(7)) NIN=6
      IF(EFINAL.LT.EIN(6)) NIN=5
      IF(EFINAL.LT.EIN(5)) NIN=4
      IF(EFINAL.LT.EIN(4)) NIN=3
      IF(EFINAL.LT.EIN(3)) NIN=2
      IF(EFINAL.LT.EIN(2)) NIN=1
      END
