CDECK  ID>, GAS18.
      SUBROUTINE GAS18(Q,QIN,NIN,E,EIN,NAME,VIRIAL,EOBY
     /,PEQEL,PEQIN,KEL,KIN,SCRPT)
      IMPLICIT REAL*8 (A-H,O-Z)
       DOUBLE PRECISION PIR2,ECHARG,EMASS,AMU,BOLTZ,BOLTZJ,
     -      AWB,ALOSCH,ABZERO,ATMOS
       PARAMETER(PIR2=8.79735534D-17)
       PARAMETER(ECHARG=1.602176462D-19)
       PARAMETER(EMASS=9.10938188D-31)
       PARAMETER(AMU=1.66053873D-27)
       PARAMETER(BOLTZ=8.617342D-5)
       PARAMETER(BOLTZJ=1.3806503D-23)
       PARAMETER(AWB=1.758820174D10)
       PARAMETER(ALOSCH=2.6867775D19)
       PARAMETER(ABZERO=273.15D0)
       PARAMETER(ATMOS=760.0D0)
       INTEGER NGAS,NSTEP,IDBG
       DOUBLE PRECISION EFINAL,ESTEP,AKT,ARY,TEMPC,TORR
       PARAMETER(ARY=13.60569172)
       COMMON/INPT/NGAS,NSTEP,EFINAL,ESTEP,AKT,TEMPC,TORR,IDBG
*-----------------------------------------------------------------------
*   MAGPAR - Interface parameters for gas mixing with Magboltz.
*   (Last changed on  2/ 3/08.)
*-----------------------------------------------------------------------
       INTEGER MXGNAM
       PARAMETER(MXGNAM=60)
       DOUBLE PRECISION FRAMIX
       LOGICAL LF0PLT,LCSPLT,LGKEEP,LBMCPR
       COMMON /MAGPAR/ FRAMIX(MXGNAM),LF0PLT,LCSPLT,LGKEEP,LBMCPR
       LOGICAL         LINPUT,LCELPR,LCELPL,LWRMRK,LISOCL,LCHGCH,
     -         LDRPLT,LDRPRT,LCLPRT,LCLPLT,LMAPCH,LCNTAM,
     -         LDEBUG,LIDENT,LKEYPL,LRNDMI,LPROPR,LPROF,LGSTOP,LGSIG,
     -         LSYNCH,LINPRD
       INTEGER LUNOUT,JFAIL,JEXMEM
       COMMON /PRTPLT/ LINPUT,LCELPR,LCELPL,LWRMRK,LISOCL,LCHGCH,
     -         LDRPLT,LDRPRT,LCLPRT,LCLPLT,LMAPCH,LCNTAM,
     -         LDEBUG,LIDENT,LKEYPL,LRNDMI,LPROPR,LPROF,LGSTOP,LGSIG,
     -         LSYNCH,LINPRD,LUNOUT,JFAIL,JEXMEM
      DIMENSION PEQEL(6,2048),PEQIN(220,2048),KIN(220),KEL(6)
      DIMENSION Q(6,2048),QIN(220,2048),E(6),EIN(220),PJ(60)
      DIMENSION XEN(69),YXSEC(69),XION(47),YION(47),XATT(51),YATT(51),
     /XEXC1(28),YEXC1(28),XEXC2(24),YEXC2(24),XEXC3(25),YEXC3(25),
     /XVIBH(19),YVIBH(19),XVIBR(19),YVIBR(19)
      CHARACTER*30 SCRPT(226)
      CHARACTER*15 NAME
C ELASTIC +ROTATION MOMENTUM TRANSFER
      DATA XEN/0.00,0.001,.0034,0.01,.012,.014,.017,0.02,.025,0.03,
     /0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.12,0.14,0.17,
     /0.20,0.25,0.30,0.35,0.40,0.50,0.60,0.70,0.80,1.00,
     /1.20,1.40,1.60,1.80,2.00,2.20,2.40,2.60,3.00,4.00,
     /5.00,6.00,7.00,8.00,9.00,10.0,12.0,14.0,17.0,20.0,
     /25.0,30.0,40.0,50.0,60.0,70.0,80.0,90.0,100.,140.,
     /200.,250.,300.,400.,500.,700.,1000.,10000.,100000./
      DATA YXSEC/180.,150.,105.,54.5,48.5,43.5,39.0,35.2,30.5,27.3,
     /22.6,19.8,17.5,15.5,13.4,12.1,10.8,8.90,7.55,6.10,
     /5.20,4.20,3.70,3.35,3.20,3.10,3.15,3.25,3.35,3.65,
     /4.30,5.00,6.30,8.70,10.2,11.5,12.0,11.5,10.2,8.90,
     /8.60,9.00,9.50,10.2,10.7,11.1,11.4,11.1,10.0,8.81,
     /7.31,6.44,5.21,4.40,3.81,3.41,2.88,2.65,2.33,1.59,
     /1.14,0.88,0.73,0.50,0.38,0.25,0.16,0.016,0.0016/
C IONISATION
      DATA XION/12.886,14.0,14.5,15.0,16.0,17.0,18.0,20.0,21.0,22.5,
     /25.0,30.0,35.0,40.0,45.0,50.0,55.0,60.0,70.0,80.0,
     /90.0,100.,110.,120.,140.,160.,200.,250.,300.,350.,
     /400.,450.,500.,600.,700.,800.,900.,1000.,1500.,2000.,
     /3000.,4000.,6000.,10000.,20000.,40000.,100000./
      DATA YION/0.00,.065,.135,.175,.255,.330,.414,.602,0.72,0.877,
     /1.16,1.61,2.03,2.34,2.61,2.82,3.02,3.18,3.46,3.63,
     /3.71,3.76,3.77,3.76,3.73,3.63,3.44,3.17,2.94,2.72,
     /2.51,2.36,2.22,1.95,1.77,1.62,1.49,1.42,1.05,0.83,
     /0.60,0.48,0.34,.218,.119,.065,.028/
C ATACHMENT
      DATA XATT/0.20,0.25,0.30,0.40,0.50,0.60,0.70,0.80,0.90,1.00,
     /1.10,1.20,1.30,1.40,1.50,1.60,1.70,1.80,1.90,2.00,
     /2.10,2.20,2.30,2.40,2.50,2.60,2.70,2.80,2.90,3.00,
     /3.10,3.20,3.30,3.40,3.50,3.60,3.70,3.80,3.90,4.00,
     /4.30,5.00,6.00,7.00,8.00,9.00,10.0,11.0,12.0,14.0,
     /16.0/
      DATA YATT/0.00,0.01,0.02,0.25,0.90,1.12,1.16,1.23,1.35,1.45,
     /1.52,1.61,1.70,1.76,2.05,2.29,2.92,3.59,4.48,5.35,
     /6.02,6.58,6.58,6.18,5.45,4.60,3.72,2.75,2.00,1.48,
     /1.07,0.75,0.48,0.36,0.27,0.22,0.17,0.15,0.13,0.10,
     /0.08,0.08,0.09,0.12,0.23,0.34,0.57,0.69,0.46,0.15,
     /0.00/
C VIBRATIONS
      DATA XVIBH/.073,1.00,1.20,1.40,1.60,1.80,2.00,2.20,2.40,2.60,
     /2.80,3.00,3.20,3.40,3.60,3.80,4.00,10.0,100000./
      DATA YVIBH/0.00,.022,.062,.144,.291,.500,.735,.927,1.00,.927,
     /.735,.500,.291,.144,.062,.022,.007,.000001,.000000001/
      DATA XVIBR/.073,5.20,5.60,6.00,6.40,6.80,7.20,7.60,8.00,8.40,
     /8.80,9.20,9.60,10.0,10.4,10.8,11.2,15.0,100000./
      DATA YVIBR/0.00,.006,0.02,.065,.174,.375,.644,.896,1.00,.896,
     /.644,.375,.174,.065,0.02,.006,.001,.000001,.000000001/
C EXCITATIONS
      DATA XEXC1/4.06,4.50,5.00,6.00,7.00,8.00,9.00,10.0,12.0,14.0,
     /17.0,20.0,25.0,30.0,40.0,50.0,60.0,70.0,80.0,90.0,
     /100.,140.,200.,300.,500.,1000.,10000.,100000./
      DATA YEXC1/0.00,0.55,0.83,0.93,0.93,0.84,0.78,0.69,0.60,0.50,
     /0.42,0.34,0.26,0.21,0.15,0.12,0.10,0.08,0.07,0.06,
     /0.05,.034,.022,.014,.008,.004,.0004,.00004/
      DATA XEXC2/8.50,9.00,10.0,12.0,14.0,17.0,20.0,25.0,30.0,40.0,
     /50.0,60.0,70.0,80.0,100.,140.,200.,300.,400.,500.,
     /700.,1000.,10000.,100000./
      DATA YEXC2/0.00,.016,.048,0.12,0.22,0.34,0.47,0.62,0.73,0.81,
     /0.75,0.64,0.57,0.48,0.36,0.26,0.17,0.12,.083,.067,
     /.046,.034,.003,.0003/
      DATA XEXC3/9.60,10.0,12.0,14.0,17.0,20.0,25.0,30.0,40.0,50.0,
     /60.0,70.0,80.0,90.0,100.,140.,200.,250.,300.,400.,
     /500.,700.,1000.,10000.,100000./
      DATA YEXC3/0.00,.036,0.26,0.76,1.44,2.23,3.20,3.87,4.40,4.40,
     /3.81,3.41,2.88,2.65,2.33,1.59,1.14,0.88,0.76,0.56,
     /0.44,0.33,0.25,.025,.0025/
      NAME='N2O (2004)'
C ----------------------------------------------------------------------
C DRIFT DIFFUSION AND TOWNSEND EXP DATA:
C  PACK VOSHALL AND PHELPS   PHYS.REV. 127 (1962) 2084
C  YOSHIDA SASAKI ET AL      J.PHYS.D  32  (1999) 862
C
C UPDATE OF HAYASHI X-SECTIONS INCLUDING NEW X-SECTION MEASUREMENTS BY:
C  KITAJIMA SAKAMOTO GULLEY BUCKMAN ET AL   J.PHYS.B 33(2000) 1687
C        AKTHER ET AL                       J.PHYS.B 35(2002) L481
C ---------------------------------------------------------------------
C  MOD OF 2003 DATA TO INCLUDE DIPOLE ROTATIONAL TRANSITIONS.
C  USED LINEAR UNSYMMETRIC ROTOR MODEL.
C  USED ANISOTROPIC ANGULAR BORN DIPOLE ROTATIONAL SCATTERING
C ---------------------------------------------------------------------
C   SCALEAT = SCALE FACTOR TO ALLOW FOR DEATTACHMENT COLLISIONS
C             SET SCALE =0.0 FOR COMPLETE DEATTACHMENT
C             SET SCALE =1.0 FOR NO DEATTACHMENT
C ---------------------------------------------------------------------
      SCALEAT=1.0
C
      AMPV2=0.06
      AMPV1=0.24
      AMPV3=0.12
      AMPV3=0.18
      ARESV2=2.65
      ARESV1=2.55
      ARESV3=0.30
      ARES2V1=0.95
      ARESVR=0.62
      NIN=131
      DO 1 J=1,6
    1 KEL(J)=0
      DO 2 J=1,NIN
      KIN(J)=0
    2 IF(J.LE.120) KIN(J)=1
      NDATA=69
      NION=47
      NATT=51
      NVIBH=19
      NVIBR=19
      NEXC1=28
      NEXC2=24
      NEXC3=25
      E(1)=0.0
      E(2)=2.0*EMASS/(44.01288*AMU)
      E(3)=12.886
      E(4)=0.0
      E(5)=0.0
      E(6)=0.0
      EOBY=12.886
C  B0 IS ROTATIONAL CONSTANT AND DBA IS DIPOLE MOMENT
C  DRAT IS RATIO OF MOMENTUM TRANSFER TO TOTAL X-SECTION FOR DIPOLE
C --------------------------------------------------------------------
      B0=5.185D-5
      DBA=0.06326
      DRAT=0.25
      A0=0.5291772083D-8
      RY=13.60569172
      DBK=8.37758*RY*(DBA*A0)**2
C --------------------------------------------------------------
C  CALCULATE ROTATIONAL STATE POPULATION AT TEMPERATURE AKT
      DO 3 K=1,60
    3 PJ(K)=(2*K+1)*EXP(-K*(K+1)*B0/AKT)
      SUM=1.0D0
      DO 4 K=1,60
    4 SUM=SUM+PJ(K)
      FROT0=1.0D0/SUM
      DO 5 K=1,60
    5 PJ(K)=PJ(K)/SUM
C CALCULATE ROTATIONAL TRANSITION ENERGIES
      DO 6 K=1,60
      J=K-1
      EIN(K+60)=B0*2*(J+1)
    6 EIN(K)=-EIN(K+60)
      EIN(121)=-0.073
      EIN(122)=0.073
      EIN(123)=-0.15932
      EIN(124)=0.15932
      EIN(125)=0.27717
      EIN(126)=0.318
      EIN(127)=0.477
      EIN(128)=0.636
      EIN(129)=4.06
      EIN(130)=8.50
      EIN(131)=9.60
      APOPV2=EXP(EIN(121)/AKT)
      APOPV1=EXP(EIN(123)/AKT)
C     IF(LBMCPR)WRITE(LUNOUT,99) FROT0,(PJ(J),J=1,60)
C  99 FORMAT(2X,'POP OF STATES=',/,10(2X,D10.3))
C     IF(LBMCPR)WRITE(LUNOUT,98) (EIN(J),J=1,140)
C  98 FORMAT(2X,'TRANS ENERGY=',/,10(2X,D10.3))
      SCRPT(1)='                              '
      SCRPT(2)=' ELASTIC       NITROUS OXIDE  '
      SCRPT(3)=' IONISATION    ELOSS= 12.886  '
      SCRPT(4)=' ATTACHMENT (NO DEATTACHMENT) '
      SCRPT(5)='                              '
      SCRPT(6)='                              '
      SCRPT(7)=' ROT 1-0       ELOSS= -0.00010'
      SCRPT(8)=' ROT 2-1       ELOSS= -0.00021'
      SCRPT(9)=' ROT 3-2       ELOSS= -0.00031'
      SCRPT(10)=' ROT 4-3       ELOSS= -0.00041'
      SCRPT(11)=' ROT 5-4       ELOSS= -0.00052'
      SCRPT(12)=' ROT 6-5       ELOSS= -0.00062'
      SCRPT(13)=' ROT 7-6       ELOSS= -0.00073'
      SCRPT(14)=' ROT 8-7       ELOSS= -0.00083'
      SCRPT(15)=' ROT 9-8       ELOSS= -0.00093'
      SCRPT(16)=' ROT 10-9      ELOSS= -0.00104'
      SCRPT(17)=' ROT 11-10     ELOSS= -0.00114'
      SCRPT(18)=' ROT 12-11     ELOSS= -0.00124'
      SCRPT(19)=' ROT 13-12     ELOSS= -0.00135'
      SCRPT(20)=' ROT 14-13     ELOSS= -0.00145'
      SCRPT(21)=' ROT 15-14     ELOSS= -0.00156'
      SCRPT(22)=' ROT 16-15     ELOSS= -0.00166'
      SCRPT(23)=' ROT 17-16     ELOSS= -0.00176'
      SCRPT(24)=' ROT 18-17     ELOSS= -0.00187'
      SCRPT(25)=' ROT 19-18     ELOSS= -0.00197'
      SCRPT(26)=' ROT 20-19     ELOSS= -0.00207'
      SCRPT(27)=' ROT 21-20     ELOSS= -0.00218'
      SCRPT(28)=' ROT 22-21     ELOSS= -0.00228'
      SCRPT(29)=' ROT 23-22     ELOSS= -0.00239'
      SCRPT(30)=' ROT 24-23     ELOSS= -0.00249'
      SCRPT(31)=' ROT 25-24     ELOSS= -0.00259'
      SCRPT(32)=' ROT 26-25     ELOSS= -0.00270'
      SCRPT(33)=' ROT 27-26     ELOSS= -0.00280'
      SCRPT(34)=' ROT 28-27     ELOSS= -0.00290'
      SCRPT(35)=' ROT 29-28     ELOSS= -0.00301'
      SCRPT(36)=' ROT 30-29     ELOSS= -0.00311'
      SCRPT(37)=' ROT 31-30     ELOSS= -0.00321'
      SCRPT(38)=' ROT 32-31     ELOSS= -0.00332'
      SCRPT(39)=' ROT 33-32     ELOSS= -0.00342'
      SCRPT(40)=' ROT 34-33     ELOSS= -0.00353'
      SCRPT(41)=' ROT 35-34     ELOSS= -0.00363'
      SCRPT(42)=' ROT 36-35     ELOSS= -0.00373'
      SCRPT(43)=' ROT 37-36     ELOSS= -0.00384'
      SCRPT(44)=' ROT 38-37     ELOSS= -0.00394'
      SCRPT(45)=' ROT 39-38     ELOSS= -0.00404'
      SCRPT(46)=' ROT 40-39     ELOSS= -0.00415'
      SCRPT(47)=' ROT 41-40     ELOSS= -0.00425'
      SCRPT(48)=' ROT 42-41     ELOSS= -0.00436'
      SCRPT(49)=' ROT 43-42     ELOSS= -0.00446'
      SCRPT(50)=' ROT 44-43     ELOSS= -0.00456'
      SCRPT(51)=' ROT 45-44     ELOSS= -0.00467'
      SCRPT(52)=' ROT 46-45     ELOSS= -0.00477'
      SCRPT(53)=' ROT 47-46     ELOSS= -0.00487'
      SCRPT(54)=' ROT 48-47     ELOSS= -0.00498'
      SCRPT(55)=' ROT 49-48     ELOSS= -0.00508'
      SCRPT(56)=' ROT 50-49     ELOSS= -0.00519'
      SCRPT(57)=' ROT 51-50     ELOSS= -0.00529'
      SCRPT(58)=' ROT 52-51     ELOSS= -0.00539'
      SCRPT(59)=' ROT 53-52     ELOSS= -0.00550'
      SCRPT(60)=' ROT 54-53     ELOSS= -0.00560'
      SCRPT(61)=' ROT 55-54     ELOSS= -0.00570'
      SCRPT(62)=' ROT 56-55     ELOSS= -0.00581'
      SCRPT(63)=' ROT 57-56     ELOSS= -0.00591'
      SCRPT(64)=' ROT 58-57     ELOSS= -0.00601'
      SCRPT(65)=' ROT 59-58     ELOSS= -0.00612'
      SCRPT(66)=' ROT 60-59     ELOSS= -0.00622'
      SCRPT(67)=' ROT 0-1       ELOSS=  0.00010'
      SCRPT(68)=' ROT 1-2       ELOSS=  0.00021'
      SCRPT(69)=' ROT 2-3       ELOSS=  0.00031'
      SCRPT(70)=' ROT 3-4       ELOSS=  0.00041'
      SCRPT(71)=' ROT 4-5       ELOSS=  0.00052'
      SCRPT(72)=' ROT 5-6       ELOSS=  0.00062'
      SCRPT(73)=' ROT 6-7       ELOSS=  0.00073'
      SCRPT(74)=' ROT 7-8       ELOSS=  0.00083'
      SCRPT(75)=' ROT 8-9       ELOSS=  0.00093'
      SCRPT(76)=' ROT 9-10      ELOSS=  0.00104'
      SCRPT(77)=' ROT 10-11     ELOSS=  0.00114'
      SCRPT(78)=' ROT 11-12     ELOSS=  0.00124'
      SCRPT(79)=' ROT 12-13     ELOSS=  0.00135'
      SCRPT(80)=' ROT 13-14     ELOSS=  0.00145'
      SCRPT(81)=' ROT 14-15     ELOSS=  0.00156'
      SCRPT(82)=' ROT 15-16     ELOSS=  0.00166'
      SCRPT(83)=' ROT 16-17     ELOSS=  0.00176'
      SCRPT(84)=' ROT 17-18     ELOSS=  0.00187'
      SCRPT(85)=' ROT 18-19     ELOSS=  0.00197'
      SCRPT(86)=' ROT 19-20     ELOSS=  0.00207'
      SCRPT(87)=' ROT 20-21     ELOSS=  0.00218'
      SCRPT(88)=' ROT 21-22     ELOSS=  0.00228'
      SCRPT(89)=' ROT 22-23     ELOSS=  0.00239'
      SCRPT(90)=' ROT 23-24     ELOSS=  0.00249'
      SCRPT(91)=' ROT 24-25     ELOSS=  0.00259'
      SCRPT(92)=' ROT 25-26     ELOSS=  0.00270'
      SCRPT(93)=' ROT 26-27     ELOSS=  0.00280'
      SCRPT(94)=' ROT 27-28     ELOSS=  0.00290'
      SCRPT(95)=' ROT 28-29     ELOSS=  0.00301'
      SCRPT(96)=' ROT 29-30     ELOSS=  0.00311'
      SCRPT(97)=' ROT 30-31     ELOSS=  0.00321'
      SCRPT(98)=' ROT 31-32     ELOSS=  0.00332'
      SCRPT(99)=' ROT 32-33     ELOSS=  0.00342'
      SCRPT(100)=' ROT 33-34     ELOSS=  0.00353'
      SCRPT(101)=' ROT 34-35     ELOSS=  0.00363'
      SCRPT(102)=' ROT 35-36     ELOSS=  0.00373'
      SCRPT(103)=' ROT 36-37     ELOSS=  0.00384'
      SCRPT(104)=' ROT 37-38     ELOSS=  0.00394'
      SCRPT(105)=' ROT 38-39     ELOSS=  0.00404'
      SCRPT(106)=' ROT 39-40     ELOSS=  0.00415'
      SCRPT(107)=' ROT 40-41     ELOSS=  0.00425'
      SCRPT(108)=' ROT 41-42     ELOSS=  0.00436'
      SCRPT(109)=' ROT 42-43     ELOSS=  0.00446'
      SCRPT(110)=' ROT 43-44     ELOSS=  0.00456'
      SCRPT(111)=' ROT 44-45     ELOSS=  0.00467'
      SCRPT(112)=' ROT 45-46     ELOSS=  0.00477'
      SCRPT(113)=' ROT 46-47     ELOSS=  0.00487'
      SCRPT(114)=' ROT 47-48     ELOSS=  0.00498'
      SCRPT(115)=' ROT 48-49     ELOSS=  0.00508'
      SCRPT(116)=' ROT 49-50     ELOSS=  0.00519'
      SCRPT(117)=' ROT 50-51     ELOSS=  0.00529'
      SCRPT(118)=' ROT 51-52     ELOSS=  0.00539'
      SCRPT(119)=' ROT 52-53     ELOSS=  0.00550'
      SCRPT(120)=' ROT 53-54     ELOSS=  0.00560'
      SCRPT(121)=' ROT 54-55     ELOSS=  0.00570'
      SCRPT(122)=' ROT 55-56     ELOSS=  0.00581'
      SCRPT(123)=' ROT 56-57     ELOSS=  0.00591'
      SCRPT(124)=' ROT 57-58     ELOSS=  0.00601'
      SCRPT(125)=' ROT 58-59     ELOSS=  0.00612'
      SCRPT(126)=' ROT 59-60     ELOSS=  0.00622'
      SCRPT(127)=' VIB V2        ELOSS= -0.073  '
      SCRPT(128)=' VIB V2        ELOSS=  0.073  '
      SCRPT(129)=' VIB V1        ELOSS= -0.159  '
      SCRPT(130)=' VIB V1        ELOSS=  0.159  '
      SCRPT(131)=' VIB V3        ELOSS=  0.277  '
      SCRPT(132)=' VIB 2V1       ELOSS=  0.318  '
      SCRPT(133)=' VIB 3V1       ELOSS=  0.477  '
      SCRPT(134)=' VIB HIGH      ELOSS=  0.636  '
      SCRPT(135)=' EXC           ELOSS=  4.06   '
      SCRPT(136)=' EXC           ELOSS=  8.50   '
      SCRPT(137)=' EXC           ELOSS=  9.60   '
      EN=-ESTEP/2.0D0
      DO 1000 I=1,NSTEP
      EN=EN+ESTEP
      DO 10 J=2,NDATA
      IF(EN.LE.XEN(J)) GO TO 20
   10 CONTINUE
      J=NDATA
   20 A=(YXSEC(J)-YXSEC(J-1))/(XEN(J)-XEN(J-1))
      B=(XEN(J-1)*YXSEC(J)-XEN(J)*YXSEC(J-1))/(XEN(J-1)-XEN(J))
      Q(2,I)=(A*EN+B)*1.0D-16
C
      Q(3,I)=0.0D0
      IF(EN.LT.E(3)) GO TO 50
      DO 30 J=2,NION
      IF(EN.LE.XION(J)) GO TO 40
   30 CONTINUE
      J=NION
   40 A=(YION(J)-YION(J-1))/(XION(J)-XION(J-1))
      B=(XION(J-1)*YION(J)-XION(J)*YION(J-1))/(XION(J-1)-XION(J))
      Q(3,I)=(A*EN+B)*1.D-16
C
   50 Q(4,I)=0.0D0
      IF(EN.LT.XATT(1)) GO TO 60
      IF(EN.GT.XATT(NATT)) GO TO 60
      DO 51 J=2,NATT
      IF(EN.LE.XATT(J)) GO TO 52
   51 CONTINUE
      J=NATT
   52 A=(YATT(J)-YATT(J-1))/(XATT(J)-XATT(J-1))
      B=(XATT(J-1)*YATT(J)-XATT(J)*YATT(J-1))/(XATT(J-1)-XATT(J))
      Q(4,I)=(A*EN+B)*1.D-18*SCALEAT
C
   60 Q(5,I)=0.0D0
      Q(6,I)=0.0D0
C----------------------------------------------------------------------
C DIPOLE BORN ROTATIONAL STATES
C---------------------------------------------------------------------
      ENRT=SQRT(EN)
C SUPERELASTIC COLLISIONS
      DO 100 L=1,60
      AL=DBLE(L)
      QIN(L,I)=PJ(L)*DBK*LOG((ENRT+SQRT(EN-EIN(L)))/(SQRT(EN-EIN(L))-
     /ENRT))*AL/((2.0*AL+1.0)*EN)
  100 PEQIN(L,I)=0.5+(QIN(L,I)-DRAT*QIN(L,I))/QIN(L,I)
C ROT 0-1
      QIN(61,I)=0.0D0
      IF(EN.LE.EIN(61)) GO TO 200
      QIN(61,I)=FROT0*DBK*LOG((ENRT+SQRT(EN-EIN(61)))/(ENRT-SQRT(EN-
     /EIN(61))))/EN
      PEQIN(61,I)=0.5+(QIN(61,I)-DRAT*QIN(61,I))/QIN(61,I)
C ROT 1-2 AND HIGHER
      DO 160 L=62,120
      QIN(L,I)=0.0D0
      IF(EN.LE.EIN(L)) GO TO 200
      AL=DBLE(L-61)
      QIN(L,I)=PJ(L-61)*DBK*LOG((ENRT+SQRT(EN-EIN(L)))/(ENRT-SQRT(EN-
     /EIN(L))))*(AL+1.0)/((2.0*AL+1.0)*EN)
  160 PEQIN(L,I)=0.5+(QIN(L,I)-DRAT*QIN(L,I))/QIN(L,I)
C
C SUPERELASTIC V2 BEND MODE
  200 QIN(121,I)=0.0D0
      IF(EN.LE.0.0) GO TO 325
      EFAC=SQRT(1.0-(EIN(121)/EN))
      QIN(121,I)=AMPV2*LOG((EFAC+1.0)/(EFAC-1.0))/EN
      DO 310 J=2,NVIBH
      IF((EN+EIN(122)).LE.XVIBH(J)) GO TO 320
  310 CONTINUE
      J=NVIBH
  320 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(121,I)=QIN(121,I)+ARESV2*(EN+EIN(122))*(A*(EN+EIN(122))+B)/EN
C   FACTOR 0.5 FROM LEVEL DEGENERACY
      QIN(121,I)=0.5*QIN(121,I)*APOPV2/(1.0+APOPV2)*1.D-16
C V2 BEND MODE
  325 CONTINUE
      QIN(122,I)=0.0D0
      IF(EN.LE.EIN(122)) GO TO 350
      EFAC=SQRT(1.0-(EIN(122)/EN))
      QIN(122,I)=AMPV2*LOG((1.0+EFAC)/(1.0-EFAC))/EN
      DO 330 J=2,NVIBH
      IF(EN.LE.XVIBH(J)) GO TO 340
  330 CONTINUE
      J=NVIBH
  340 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(122,I)=QIN(122,I)+ARESV2*(A*EN+B)
      QIN(122,I)=QIN(122,I)*1.0/(1.0+APOPV2)*1.D-16
  350 CONTINUE
C SUPERELASTIC V1 SYMMETRIC STRETCH
      QIN(123,I)=0.0D0
      IF(EN.LE.0.0) GO TO 375
      EFAC=SQRT(1.0-(EIN(123)/EN))
      QIN(123,I)=AMPV1*LOG((EFAC+1.0)/(EFAC-1.0))/EN
      DO 360 J=2,NVIBH
      IF((EN+EIN(124)).LE.XVIBH(J)) GO TO 370
  360 CONTINUE
      J=NVIBH
  370 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(123,I)=QIN(123,I)+ARESV1*(EN+EIN(124))*(A*(EN+EIN(124))+B)/EN
      DO 371 J=2,NVIBR
      IF((EN+EIN(124)).LE.XVIBR(J)) GO TO 372
  371 CONTINUE
      J=NVIBR
  372 A=(YVIBR(J)-YVIBR(J-1))/(XVIBR(J)-XVIBR(J-1))
      B=(XVIBR(J-1)*YVIBR(J)-XVIBR(J)*YVIBR(J-1))/(XVIBR(J-1)-XVIBR(J))
      QIN(123,I)=QIN(123,I)+ARESVR*(EN+EIN(124))*(A*(EN+EIN(124))+B)/EN
      QIN(123,I)=QIN(123,I)*APOPV1/(1.0+APOPV1)*1.D-16
C V1 SYMMETRIC STRETCH
  375 CONTINUE
      QIN(124,I)=0.0D0
      IF(EN.LE.EIN(124)) GO TO 400
      EFAC=SQRT(1.0-(EIN(124)/EN))
      QIN(124,I)=AMPV1*LOG((1.0+EFAC)/(1.0-EFAC))/EN
      DO 380 J=2,NVIBH
      IF(EN.LE.XVIBH(J)) GO TO 390
  380 CONTINUE
      J=NVIBH
  390 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(124,I)=QIN(124,I)+ARESV1*(A*EN+B)
      DO 391 J=2,NVIBR
      IF(EN.LE.XVIBR(J)) GO TO 392
  391 CONTINUE
      J=NVIBR
  392 A=(YVIBR(J)-YVIBR(J-1))/(XVIBR(J)-XVIBR(J-1))
      B=(XVIBR(J-1)*YVIBR(J)-XVIBR(J)*YVIBR(J-1))/(XVIBR(J-1)-XVIBR(J))
      QIN(124,I)=QIN(124,I)+ARESVR*(A*EN+B)
      QIN(124,I)=QIN(124,I)*1.0/(1.0+APOPV1)*1.D-16
  400 CONTINUE
C V3 ASYMMETRIC STRETCH
      QIN(125,I)=0.0D0
      IF(EN.LE.EIN(125)) GO TO 450
      EFAC=SQRT(1.0-(EIN(125)/EN))
      QIN(125,I)=AMPV3*LOG((1.0+EFAC)/(1.0-EFAC))/EN
      DO 410 J=2,NVIBH
      IF(EN.LE.XVIBH(J)) GO TO 420
  410 CONTINUE
      J=NVIBH
  420 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(125,I)=QIN(125,I)+ARESV3*(A*EN+B)
      QIN(125,I)=QIN(125,I)*1.D-16
C 2V1 SYMMETRIC STRETCH HARMONICS
  450 CONTINUE
      QIN(126,I)=0.0D0
      IF(EN.LE.EIN(126)) GO TO 500
      DO 460 J=2,NVIBH
      IF(EN.LE.XVIBH(J)) GO TO 470
  460 CONTINUE
      J=NVIBH
  470 A=(YVIBH(J)-YVIBH(J-1))/(XVIBH(J)-XVIBH(J-1))
      B=(XVIBH(J-1)*YVIBH(J)-XVIBH(J)*YVIBH(J-1))/(XVIBH(J-1)-XVIBH(J))
      QIN(126,I)=ARES2V1*(A*EN+B)*1.D-16
C 3V1 SYMMETRIC STRETCH HARMONICS
  500 CONTINUE
      QIN(127,I)=0.0D0
      IF(EN.LE.EIN(127)) GO TO 550
      QIN(127,I)=QIN(126,I)*0.6
C SUM OF HIGHER VIBRATIONAL HARMONICS
  550 CONTINUE
      QIN(128,I)=0.0D0
      IF(EN.LE.EIN(128)) GO TO 600
      QIN(128,I)=QIN(127,I)*0.9
  600 CONTINUE
      QIN(129,I)=0.0D0
      IF(EN.LE.EIN(129)) GO TO 650
      DO 610 J=2,NEXC1
      IF(EN.LE.XEXC1(J)) GO TO 620
  610 CONTINUE
      J=NEXC1
  620 A=(YEXC1(J)-YEXC1(J-1))/(XEXC1(J)-XEXC1(J-1))
      B=(XEXC1(J-1)*YEXC1(J)-XEXC1(J)*YEXC1(J-1))/(XEXC1(J-1)-XEXC1(J))
      QIN(129,I)=(A*EN+B)*1.D-16
  650 CONTINUE
      QIN(130,I)=0.0D0
      IF(EN.LE.EIN(130)) GO TO 700
      DO 660 J=2,NEXC2
      IF(EN.LE.XEXC2(J)) GO TO 670
  660 CONTINUE
      J=NEXC2
  670 A=(YEXC2(J)-YEXC2(J-1))/(XEXC2(J)-XEXC2(J-1))
      B=(XEXC2(J-1)*YEXC2(J)-XEXC2(J)*YEXC2(J-1))/(XEXC2(J-1)-XEXC2(J))
      QIN(130,I)=(A*EN+B)*1.D-16
  700 CONTINUE
      QIN(131,I)=0.0D0
      IF(EN.LE.EIN(131)) GO TO 750
      DO 710 J=2,NEXC3
      IF(EN.LE.XEXC3(J)) GO TO 720
  710 CONTINUE
      J=NEXC3
  720 A=(YEXC3(J)-YEXC3(J-1))/(XEXC3(J)-XEXC3(J-1))
      B=(XEXC3(J-1)*YEXC3(J)-XEXC3(J)*YEXC3(J-1))/(XEXC3(J-1)-XEXC3(J))
      QIN(131,I)=(A*EN+B)*1.D-16
  750 CONTINUE
      SUMROT=0.0D0
      DO 800 L=1,120
  800 SUMROT=SUMROT+QIN(L,I)
C GET ELASTIC MOMENTUM TRANSFER
      Q(2,I)=Q(2,I)-SUMROT*DRAT
C Q(1,I) USED ONLY FOR INFORMATION
      Q(1,I)=Q(2,I)+Q(3,I)+Q(4,I)+QIN(121,I)+QIN(122,I)+QIN(123,I)+
     /QIN(124,I)+QIN(125,I)+QIN(126,I)+QIN(127,I)+QIN(128,I)+QIN(129,I)+
     /QIN(130,I)+QIN(131,I)+SUMROT*DRAT
 1000 CONTINUE
C  SAVE COMPUTE TIME
      IF(EFINAL.LE.EIN(131)) NIN=130
      IF(EFINAL.LE.EIN(130)) NIN=129
      IF(EFINAL.LE.EIN(129)) NIN=128
      IF(EFINAL.LE.EIN(128)) NIN=127
      IF(EFINAL.LE.EIN(127)) NIN=126
      IF(EFINAL.LE.EIN(126)) NIN=125
      IF(EFINAL.LE.EIN(125)) NIN=124
      IF(EFINAL.LE.EIN(124)) NIN=123
      END
